<div class="header clearfix header_fixed"><div class=wrap><div class=logo><a href=http://www.yiguo.com></a></div><div class=search style=position:relative;><div class="search-bar clearfix"><input type=text id=keyword name=keyword class=search-input value=输入商品名／编号／拼音 onfocus="if (this.value == '输入商品名／编号／拼音') {this.value = '';this.style.color = '#000';}" onblur="if (this.value == '') {this.value = '输入商品名／编号／拼音';this.style.color = '#999';}" style="color: rgb(153, 153, 153);"> <input class=search-btn type=submit value=搜索></div><ul class=hide id=shelper style="display: none;"></ul><div class=search-keywords id=keywords><a href="http://search.yiguo.com/?keyword=%E8%99%BE%E4%BB%81" class=hot target=_blank>虾仁</a> <a href="http://search.yiguo.com/?keyword=%E4%B8%89%E6%96%87%E9%B1%BC" class=hot target=_blank>三文鱼</a> <a href="http://search.yiguo.com/?keyword=%E5%86%B0%E9%B2%9C%E7%89%9B%E8%82%89" class=hot target=_blank>冰鲜牛肉</a> <a href="http://search.yiguo.com/?keyword=%E5%88%BA%E8%BA%AB" target=_blank>刺身</a> <a href="http://search.yiguo.com/?keyword=%E6%96%B0%E8%A5%BF%E5%85%B0%E9%B9%BF%E8%82%89" class=hot target=_blank>新西兰鹿肉</a> <a href="http://search.yiguo.com/?keyword=%E9%B3%95%E9%B1%BC" target=_blank>鳕鱼</a> <a href="http://search.yiguo.com/?keyword=%E7%89%9B%E8%85%B1" target=_blank>牛腱</a> <a href="http://search.yiguo.com/?keyword=%E5%A5%87%E5%BC%82%E6%9E%9C" target=_blank>奇异果</a> <a target=_blank></a></div></div><div class=shopping-cart><dl><dt class=shopping-btn><a href="http://cart.yiguo.com/"><span class=totleNum><b>1</b></span><b class=totlePrice>¥49.90</b></a></dt><dd class=shopping-list style="display: none;"><div class=spacer></div><div class=nogoods style=display:none;>购物车中还没有商品，赶紧选购吧！</div><div class=goods><p id=deliveryType style=display:none;>满100元包邮！</p><ul><li><div class=l><a href=http://www.yiguo.com/product/1386597.html target=_blank><img src=http://img14.yiguoimg.com/d/items/2018/180807/9288727914489095_300.jpg width=42 height=42></a></div><div class=c><a href=http://www.yiguo.com/product/1386597.html>SunMoon泰国金枕头冷冻榴莲果肉300g</a></div><div class=r><b>¥49.90</b> * 1<a href=javascript:; onclick="G.app.cart.Facade.deleteShopCartData(this,'78111493-4d80-4f49-8d0d-e35144bd7ca1|1')">删除</a></div></li></ul><div class=price-total><div><span class=totleNum>共<b>1</b>件商品</span><span>共计<b class=totlePrice>¥49.90</b></span></div><div><a href="http://cart.yiguo.com/" class=settleup>去购物车</a></div></div></div></dd></dl></div></div></div><script>

    let sidindex = myobj.getcookie('cookiesid').split(',');
    let goodsnum = 0;
    if ($.inArray(data.sid, sidindex) !== -1) {
        goodsnum = myobj.getcookie('cookienum').split(',')[$.inArray(data.sid, sidindex)];
    } else {
        goodsnum = 0;
    }

    if (myobj.getcookie('cookiesid') && myobj.getcookie('cookienum')) {
        let csid = myobj.getcookie('cookiesid').split(','); //数组
        let cnum = myobj.getcookie('cookienum').split(',');
        $.each(csid, function (index, value) {
            showgoodslist(csid[index], cnum[index]);
        })
    }

    function showgoodslist(sid, num) {
        let strlist = '';
        if (data.sid = sid) {
            strlist += `
                    <li>
                        <div class="l"><a href="http://10.31.157.56/JS-1907/project1/dist/html/details.html?sid=${data.sid}" target="_blank"><img
                                    src="${data.url}"
                                    width="42" height="42"></a></div>
                        <div class="c"><a
                                href="http://10.31.157.56/JS-1907/project1/dist/html/details.html?sid=${data.sid}">${data.title}</a>
                        </div>
                        <div class="r"><b>¥${data.price}</b> * ${goodsnum}<a href="javascript:;">删除</a>
                        </div>
                    </li>
                    `;
            $('.goods ul li').append(strlist);
        }
    }



    let strhtml = '';
    strhtml += `
            <div class="price-total">
                <div><span class="totleNum">共<b>0</b>件商品</span><span>共计<b class="totlePrice">0.0</b></span>
                </div>
                <div><a href="http://10.31.157.56/JS-1907/project1/dist/html/cart.html?sid=${data.sid}"
                        class="settleup">去购物车</a></div>
            </div>
            `;
    $('.goods ul').append(strhtml);


    // 添加到右上角的小购物车
    cookieToArray();
    let totalnum = 0;
    console.log(numarr);
    let csid = myobj.getcookie('cookiesid').split(',');
    console.log(csid);
    $.each(numarr, function (index, value) {
        totalnum += parseInt(value);
        console.log(csid[index]);
        if ($(".spic img").attr('sid') == csid[index]) {
            let pri = $(".spic img").parents(".product-intro").find(".pro-price strong").html();
        }

    })
    $('.cart').find('span b').html(totalnum);
    $('.cart').find('.shop-btn .price i').html(($('.summary-price').find('strong').html()).toFixed(2));



    var changenum = null;
    cookieToArray();
    $('.cart-list').on('click', '.increment', function () {
        console.log($(this))
        let $num = parseInt($('.itxt').val())
        $num++;
        $('.itxt').val($num);
        changenum = parseInt($('.itxt').val());//当前的数量。
        let currentsid = $(this).parents('.cart-table').find('.cart-t-img').find('img').attr('sid');
        numarr[$.inArray(currentsid, sidarr)] = changenum;//数组值改变
        myobj.addcookie('cookienum', numarr.toString(), 10);//继续添加cookie 
    });
    $('.cart-list').on('click', '.decrement', function () {
        let $num = parseInt($('.itxt').val())
        $num--;
        if ($num <= 0) {
            $num = 0;
            if (confirm('确定要删除吗？')) {
                $(this).parents('.cart-table').remove();
            }
            changenum = 0;
        } else {
            $('.itxt').val($num);
            changenum = parseInt($('.itxt').val());//原来的数量+当前的数量。
        }
        let currentsid = $(this).parents('.cart-table').find('.cart-t-img').find('img').attr('sid');
        numarr[$.inArray(currentsid, sidarr)] = changenum;//数组值改变
        myobj.addcookie('cookienum', numarr.toString(), 10);//继续添加cookie 
    })

</script>